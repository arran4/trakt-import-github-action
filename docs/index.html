<html>
    <head>
    </head>
    <body>
        <button onclick="getAuthCode()">Get Authorization Token </button>
        <input id="code">
        <button onclick="getToken()">Get token </button>
        <input id="token">
        <button onclick="logout()">Logout </button>
        <script lang="javascript">

            async function getAuthCode() {
                let state = ""
                let redirectUrl = "https://arran4.github.io/trakt-import-github-action/"
                let clientId = "a7194a79bae514974a729c7c5a474e4b7caf773f445d084a8af87ae033ec3d82"
                let queryParam = `response_type=code&state=${encodeURIComponent(state)}&redirect_uri=${encodeURIComponent(redirectUrl)}&client_id=${encodeURIComponent(clientId)}`
                window.location.replace(`https://trakt.tv/oauth/authorize?${queryParam}`)
            }

            async function getToken() {
                let code = document.getElementById("code").value;
                let data = `grant_type=authorization_code&code=${code}&redirect_uri=https%3A%2F%2Farran4.github.io%2Ftrakt-import-github-action%2F`;
                let r = await fetch('https://trakt.tv/oauth/token', {
                    method: "POST",
                    body: data
                })
                document.getElementById("token").value = (await r.text());
            }

            function logout() {
                document.getElementById("code").value = "";
                document.getElementById("token").value = "";
            }

            if (window.location.search) {
                let codeV = new URLSearchParams(window.location.search).get("code");
                if (codeV) {
                    document.getElementById("code").value = codeV;
                }
            }
            
        </script>
    </body>
</html>